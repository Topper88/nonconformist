<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ð¿ o Ð¿ c o Ð¿ f o r m i s t | Forest of Sound</title>

  <!-- LOAD THREE.JS SAFELY -->
  <script src="https://unpkg.com/three@0.167.1/build/three.min.js" defer></script>
  <script src="https://unpkg.com/three@0.167.1/examples/js/controls/OrbitControls.js" defer></script>
  <script src="https://unpkg.com/three@0.167.1/examples/js/postprocessing/EffectComposer.js" defer></script>
  <script src="https://unpkg.com/three@0.167.1/examples/js/postprocessing/RenderPass.js" defer></script>
  <script src="https://unpkg.com/three@0.167.1/examples/js/postprocessing/UnrealBloomPass.js" defer></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { overflow:hidden; background:#000; font-family:'Courier New',monospace; }
    #overlay { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10; }
    #info { position:absolute; top:20px; left:20px; color:#ddd; font-size:14px; background:rgba(0,0,0,0.4); padding:12px; border-radius:8px; max-width:320px; backdrop-filter:blur(6px); }
    #info a { color:#8cf; text-decoration:underline; }
    .tooltip { position:absolute; background:rgba(20,20,40,0.9); color:#fff; padding:8px 12px; border-radius:8px; font-size:13px; pointer-events:none; opacity:0; transition:opacity .3s; white-space:nowrap; z-index:100; backdrop-filter:blur(8px); border:1px solid #445; }
    .album-panel { position:absolute; background:rgba(15,15,35,0.97); color:#fff; padding:24px; border-radius:16px; width:340px; box-shadow:0 0 40px rgba(100,180,255,0.4); display:none; z-index:200; pointer-events:auto; backdrop-filter:blur(12px); border:1px solid #556; }
    .close-btn { float:right; cursor:pointer; font-size:22px; color:#aaa; }
    .close-btn:hover { color:#fff; }
    .play-btn { background:#5ab; color:#fff; border:none; padding:14px; margin:16px 0; border-radius:10px; cursor:pointer; font-weight:bold; width:100%; font-size:16px; }
    .reward { font-size:12px; color:#8cf; margin-top:12px; }
    canvas { display:block; }
    #loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#fff; font-size:18px; z-index:5; }
  </style>
</head>
<body>
  <div id="loading">Loading Forest... ðŸŒ²</div>

  <div id="overlay">
    <div id="info">
      <strong>Ð¿ o Ð¿ c o Ð¿ f o r m i s t</strong><br>
      <em>Forest of Sound</em><br><br>
      Hover a gramophone fruit.<br>
      Click to listen.<br>
      <a href="#" target="_blank">Reward if it moves you (add link later)</a>
    </div>
    <div class="tooltip" id="tooltip"></div>
  </div>

  <div id="album-panel" class="album-panel">
    <div class="close-btn">Ã—</div>
    <h3 id="album-title"></h3>
    <img id="album-art" width="100%" style="border-radius:10px; margin:12px 0;">
    <div id="player-container"></div>
    <button class="play-btn" id="play-btn">PLAY ALBUM</button>
    <div class="reward">
      Felt the spark? <a href="#" target="_blank">Tip what itâ€™s worth (later)</a>
    </div>
  </div>

  <!-- MAIN SCRIPT: RUNS ONLY AFTER THREE.JS LOADS -->
  <script defer>
    // Wait for THREE to load
    window.addEventListener('load', () => {
      if (typeof THREE === 'undefined') {
        document.getElementById('loading').innerHTML = 'Failed to load Three.js ðŸ˜”<br>Try refreshing.';
        console.error('THREE.js not loaded');
        return;
      }

      document.getElementById('loading').remove();

      // ==============================================================
      // YOUR FULL FOREST CODE STARTS HERE
      // ==============================================================

      const albums = [
        { title: "Optima Box: The Future Is Inviting", url: "https://on.soundcloud.com/nWSYB7e87sdZaWxtT9", color: 0x00ff88, art: "https://i1.sndcdn.com/artworks-000684027330-5v4q3t-t500x500.jpg", poem: "The future hums in neon leaves..." },
        { title: "Wisdom Box: As We Learn Cycling", url: "https://on.soundcloud.com/Mw8UtbDGZ7QhLD61jj", color: 0xa0ff00, art: "https://i1.sndcdn.com/artworks-000683927318-7p1r5t-t500x500.jpg", poem: "Wheels wobble, lessons sting..." },
        { title: "Mystery Box: It Has Always Been Here", url: "https://on.soundcloud.com/NIuOde9LeVrnLcTWCa", color: 0x8844ff, art: "https://i1.sndcdn.com/artworks-000683827306-0p2q3s-t500x500.jpg", poem: "Hidden truth beneath the rain..." },
        { title: "Romantic Box: Premature Farewell", url: "https://on.soundcloud.com/BkPQQv8bqULarvOMtw", color: 0xff4488, art: "https://i1.sndcdn.com/artworks-000683727294-8q3r2t-t500x500.jpg", poem: "Ashen hands, I see the stain..." },
        { title: "Therapy Box: Hello Mailer-Daemon", url: "https://on.soundcloud.com/kmQCqO4ulClTDsQg1O", color: 0x44ccff, art: "https://i1.sndcdn.com/artworks-000683627282-9r4s1u-t500x500.jpg", poem: "Tiny heart, the silence grows..." },
        { title: "Fiesta Box: Fruity Outcome", url: "https://on.soundcloud.com/1vbOMYoRnitq1s6r4o", color: 0xffaa00, art: "https://i1.sndcdn.com/artworks-000683527270-0s5t2v-t500x500.jpg", poem: "Each spark remembers where it grew..." },
        { title: "Energy Box: Time Is Here", url: "https://on.soundcloud.com/QNehEABnSeSodbnKWF", color: 0xffff00, art: "https://i1.sndcdn.com/artworks-000683427258-1t6u3w-t500x500.jpg", poem: "Pulse now, the moment ignites..." }
      ];

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 200);
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(innerWidth, innerHeight);
      renderer.setPixelRatio(devicePixelRatio);
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      document.body.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.07;
      controls.maxPolarAngle = Math.PI / 2.1;
      camera.position.set(0, 10, 25);

      const composer = new THREE.EffectComposer(renderer);
      const renderPass = new THREE.RenderPass(scene, camera);
      composer.addPass(renderPass);
      const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.2, 0.4, 0.85);
      composer.addPass(bloomPass);

      // Lighting
      scene.add(new THREE.AmbientLight(0x404060, 0.5));
      const moon = new THREE.DirectionalLight(0xaaccff, 1.2);
      moon.position.set(15, 30, 15);
      scene.add(moon);

      // Sky
      const sky = new THREE.Mesh(
        new THREE.SphereGeometry(150, 32, 32),
        new THREE.ShaderMaterial({
          vertexShader: `varying vec3 vPos; void main() { vPos = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
          fragmentShader: `varying vec3 vPos; uniform float t; void main() { vec3 night = vec3(0.05,0.05,0.15); vec3 dawn = vec3(0.3,0.2,0.4); float mixVal = sin(t)*0.5+0.5; gl_FragColor = vec4(mix(night, dawn, mixVal), 1.0); }`,
          uniforms: { t: { value: 0 } },
          side: THREE.BackSide
        })
      );
      scene.add(sky);

      // Ground
      const ground = new THREE.Mesh(new THREE.PlaneGeometry(300,300), new THREE.MeshStandardMaterial({color:0x0a1a0a}));
      ground.rotation.x = -Math.PI/2; ground.position.y = -3;
      scene.add(ground);

      // Gramophone
      function createGramophone(c) {
        const g = new THREE.Group();
        g.add(new THREE.Mesh(new THREE.CylinderGeometry(0.7,0.7,0.04,64), new THREE.MeshStandardMaterial({color:0x000, metalness:0.9})));
        const horn = new THREE.Mesh(new THREE.ConeGeometry(0.9,1.4,12), new THREE.MeshStandardMaterial({color:c, emissive:c, emissiveIntensity:0.6}));
        horn.position.z = 0.9; horn.rotation.x = Math.PI/2;
        g.add(horn);
        g.userData.type = 'fruit';
        return g;
      }

      // Tree
      function createTree(album, x, z) {
        const tree = new THREE.Group();
        const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.8,7,8), new THREE.MeshStandardMaterial({color:0x3d2817}));
        trunk.position.y = 2; tree.add(trunk);
        for (let i=0; i<4; i++) {
          const leaf = new THREE.Mesh(new THREE.SphereGeometry(3-i*0.4,8,6), new THREE.MeshStandardMaterial({color:0x0a2a0a, flatShading:true}));
          leaf.position.y = 5 + i*1.2; leaf.userData.wind = Math.random()*Math.PI*2;
          tree.add(leaf);
        }
        for (let i=0; i<3; i++) {
          const f = createGramophone(album.color);
          const a = (i/3)*Math.PI*2; const r = 2.5;
          f.position.set(Math.cos(a)*r, 5.5, Math.sin(a)*r);
          f.userData.album = album; f.userData.rotSpeed = 0.5 + Math.random()*0.3;
          tree.add(f);
        }
        tree.position.set(x,0,z); scene.add(tree);
        return tree;
      }

      // Place trees
      const trees = [];
      albums.forEach((a,i) => {
        const ang = (i/albums.length)*Math.PI*2;
        const d = 14 + (i%2)*6;
        trees.push(createTree(a, Math.cos(ang)*d, Math.sin(ang)*d));
      });

      // Interaction
      const ray = new THREE.Raycaster();
      const mouse = new THREE.Vector2();
      const tooltip = document.getElementById('tooltip');
      let hover = null;

      window.addEventListener('mousemove', e => {
        mouse.x = (e.clientX/innerWidth)*2-1;
        mouse.y = -(e.clientY/innerHeight)*2+1;
        ray.setFromCamera(mouse, camera);
        const hits = ray.intersectObjects(scene.children, true);
        let found = null;
        for (let h of hits) { if (h.object.parent?.userData.type === 'fruit') { found = h.object.parent; break; } }
        if (found !== hover) {
          if (hover) hover.children[1].material.emissiveIntensity = 0.6;
          hover = found;
          if (hover) {
            const al = hover.userData.album;
            tooltip.textContent = al.title.split(':')[0] + ' â€“ ' + al.poem;
            tooltip.style.left = (e.clientX+15)+'px'; tooltip.style.top = (e.clientY+15)+'px'; tooltip.style.opacity = 1;
            hover.children[1].material.emissiveIntensity = 1.2;
          } else tooltip.style.opacity = 0;
        }
      });

      window.addEventListener('click', () => {
        if (hover) {
          const a = hover.userData.album;
          document.getElementById('album-title').textContent = a.title;
          document.getElementById('album-art').src = a.art;
          document.getElementById('player-container').innerHTML = `<iframe width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=${encodeURIComponent(a.url)}&color=%235ab&auto_play=false"></iframe>`;
          document.getElementById('album-panel').style.display = 'block';
        }
      });

      document.querySelector('.close-btn').onclick = () => { document.getElementById('album-panel').style.display = 'none'; };

      // Animation
      const clock = new THREE.Clock();
      function anim() {
        const t = clock.getElapsedTime();
        sky.material.uniforms.t.value = t * 0.05;
        scene.traverse(o => {
          if (o.userData.wind !== undefined) o.rotation.z = Math.sin(t*1.5 + o.userData.wind)*0.08;
          if (o.userData.rotSpeed) o.rotation.y += o.userData.rotSpeed * 0.012;
        });
        controls.update();
        composer.render();
        requestAnimationFrame(anim);
      }
      anim();

      window.addEventListener('resize', () => {
        camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix();
        renderer.setSize(innerWidth, innerHeight); composer.setSize(innerWidth, innerHeight);
      });

      console.log('FOREST LOADED! ðŸŒ²ðŸŽ¶');
    });
  </script>
</body>
</html>
