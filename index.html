<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>п o п c o п f o r m i s t | The Circle of Seven v0.6</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; overflow:hidden; background:#000; font-family:'Courier New',monospace; }
  #info { position:absolute; top:20px; left:20px; color:#ddd; background:rgba(0,0,0,0.6); padding:15px; border-radius:12px; max-width:340px; backdrop-filter:blur(10px); z-index:10; border:1px solid #334; }
  #info a { color:#8cf; }
  .tooltip { position:absolute; background:rgba(20,20,40,0.95); color:#fff; padding:10px 16px; border-radius:10px; font-size:14px; pointer-events:none; opacity:0; transition:opacity .3s; z-index:100; backdrop-filter:blur(12px); border:1px solid #556; }
  .album-panel { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(15,15,35,0.98); color:#fff; padding:30px; border-radius:20px; width:380px; box-shadow:0 0 60px rgba(100,180,255,0.5); display:none; z-index:200; backdrop-filter:blur(16px); border:1px solid #667; }
  .close-btn { position:absolute; top:12px; right:16px; font-size:28px; cursor:pointer; color:#aaa; }
  .close-btn:hover { color:#fff; }
  #cc { position:absolute; bottom:20px; right:20px; color:#666; font-size:11px; z-index:10; }
  #cc a { color:#8cf; text-decoration:none; }
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
</head>
<body>

<div id="info">
  <strong>п o п c o п f o r m i s t</strong><br>
  <em>The Circle of Seven v0.6</em><br><br>
  Drag to orbit • Scroll to zoom • Click a chest for playlist<br>
  Click a fruit for track • Let the monument breathe<br>
  <a href="https://ko-fi.com/nnconformist" target="_blank">Tip if it moves you</a>
</div>
<div class="tooltip" id="tooltip"></div>
<div id="cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></div>

<div id="album-panel" class="album-panel">
  <div class="close-btn">×</div>
  <h3 id="album-title"></h3>
  <img id="album-art" width="100%" style="border-radius:12px; margin:16px 0;">
  <div id="player-container"></div>
</div>

<script>
  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x0a1a2f, 0.0008);
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  scene.background = new THREE.Color(0x0a0a1f);
  const stars = new THREE.Points(
    new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute(Array.from({length:9000},()=>THREE.MathUtils.randFloatSpread(2000)),3)),
    new THREE.PointsMaterial({color:0xffffff,size:1.2})
  );
  scene.add(stars);

  scene.add(new THREE.AmbientLight(0x404060, 0.9));
  const moon = new THREE.DirectionalLight(0xaaccff, 1.4);
  moon.position.set(30,50,20);
  scene.add(moon);

  const ground = new THREE.Mesh(new THREE.PlaneGeometry(800,800), new THREE.MeshStandardMaterial({color:0x0a1a0a, roughness:1}));
  ground.rotation.x = -Math.PI/2;
  ground.position.y = -1;
  scene.add(ground);

  // CENTRAL STONEHENGE
  const stonehenge = new THREE.Group();
  const stoneMat = new THREE.MeshStandardMaterial({color:0x777777, roughness:0.95});
  const left = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), stoneMat);
  left.position.set(-6,6,0);
  const right = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), stoneMat);
  right.position.set(6,6,0);
  const lintel = new THREE.Mesh(new THREE.BoxGeometry(15,3,3.5), stoneMat);
  lintel.position.set(0,13,0);
  stonehenge.add(left,right,lintel);

  const aura = new THREE.Mesh(new THREE.SphereGeometry(12,32,16), new THREE.MeshBasicMaterial({color:0x88ccff, transparent:true, opacity:0.2}));
  aura.position.y = 7;
  stonehenge.add(aura);
  scene.add(stonehenge);

  // ORBIT CONTROLS
  let radius = 70;
  let theta = 0;
  let phi = Math.PI / 3.5;
  let isDragging = false;
  let previousMouse = { x: 0, y: 0 };

  const updateCamera = () => {
    camera.position.x = radius * Math.sin(phi) * Math.cos(theta);
    camera.position.y = radius * Math.cos(phi);
    camera.position.z = radius * Math.sin(phi) * Math.sin(theta);
    camera.lookAt(0, 6, 0);
  };
  updateCamera();

  renderer.domElement.addEventListener('pointerdown', e => {
    isDragging = true;
    previousMouse = { x: e.clientX, y: e.clientY };
  });
  renderer.domElement.addEventListener('pointermove', e => {
    if (isDragging) {
      const deltaX = e.clientX - previousMouse.x;
      const deltaY = e.clientY - previousMouse.y;
      theta -= deltaX * 0.005;
      phi += deltaY * 0.005;
      phi = Math.max(0.1, Math.min(Math.PI - 0.1, phi));
      previousMouse = { x: e.clientX, y: e.clientY };
      updateCamera();
    }
  });
  renderer.domElement.addEventListener('pointerup', () => isDragging = false);
  renderer.domElement.addEventListener('wheel', e => {
    radius += e.deltaY * 0.05;
    radius = Math.max(30, Math.min(150, radius));
    updateCamera();
  });

  // ALBUMS WITH PLAYLISTS AND TRACKS
  const albums = [
    {playlist: "https://soundcloud.com/musique_residentielle/sets/wisdom-box", tracks: ["https://soundcloud.com/musique_residentielle/wb_01", "https://soundcloud.com/musique_residentielle/wb_02", "https://soundcloud.com/musique_residentielle/wb_03", "https://soundcloud.com/musique_residentielle/wb_04", "https://soundcloud.com/musique_residentielle/wb_05", "https://soundcloud.com/musique_residentielle/wb_06", "https://soundcloud.com/musique_residentielle/wb_07", "https://soundcloud.com/musique_residentielle/wb_08", "https://soundcloud.com/musique_residentielle/wb_09", "https://soundcloud.com/musique_residentielle/wb_10", "https://soundcloud.com/musique_residentielle/wb_11", "https://soundcloud.com/musique_residentielle/wb_12"], title: "Wisdom Box", art: "https://i1.sndcdn.com/artworks-000683927318-7p1r5t-t500x500.jpg", poem: "Wheels wobble, lessons sting..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/energy-box", tracks: ["https://soundcloud.com/musique_residentielle/eb_01", "https://soundcloud.com/musique_residentielle/eb_02", "https://soundcloud.com/musique_residentielle/eb_03", "https://soundcloud.com/musique_residentielle/eb_04", "https://soundcloud.com/musique_residentielle/eb_05", "https://soundcloud.com/musique_residentielle/eb_06", "https://soundcloud.com/musique_residentielle/eb_07", "https://soundcloud.com/musique_residentielle/eb_08", "https://soundcloud.com/musique_residentielle/eb_09", "https://soundcloud.com/musique_residentielle/eb_10", "https://soundcloud.com/musique_residentielle/eb_11", "https://soundcloud.com/musique_residentielle/eb_12"], title: "Energy Box", art: "https://i1.sndcdn.com/artworks-000683427258-1t6u3w-t500x500.jpg", poem: "Pulse now, the moment ignites..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/mystery-box", tracks: ["https://soundcloud.com/musique_residentielle/mb_01", "https://soundcloud.com/musique_residentielle/mb_02", "https://soundcloud.com/musique_residentielle/mb_03", "https://soundcloud.com/musique_residentielle/mb_04", "https://soundcloud.com/musique_residentielle/mb_05", "https://soundcloud.com/musique_residentielle/mb_06", "https://soundcloud.com/musique_residentielle/mb_07", "https://soundcloud.com/musique_residentielle/mb_08", "https://soundcloud.com/musique_residentielle/mb_09", "https://soundcloud.com/musique_residentielle/mb_10", "https://soundcloud.com/musique_residentielle/mb_11", "https://soundcloud.com/musique_residentielle/mb_12"], title: "Mystery Box", art: "https://i1.sndcdn.com/artworks-000683827306-0p2q3s-t500x500.jpg", poem: "Truth hides in the rain..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/optima-box", tracks: ["https://soundcloud.com/musique_residentielle/ob_01", "https://soundcloud.com/musique_residentielle/ob_02", "https://soundcloud.com/musique_residentielle/ob_03", "https://soundcloud.com/musique_residentielle/ob_04", "https://soundcloud.com/musique_residentielle/ob_05", "https://soundcloud.com/musique_residentielle/ob_06", "https://soundcloud.com/musique_residentielle/ob_07", "https://soundcloud.com/musique_residentielle/ob_08", "https://soundcloud.com/musique_residentielle/ob_09", "https://soundcloud.com/musique_residentielle/ob_10", "https://soundcloud.com/musique_residentielle/ob_11", "https://soundcloud.com/musique_residentielle/ob_12"], title: "Optima Box", art: "https://i1.sndcdn.com/artworks-000684027330-5v4q3t-t500x500.jpg", poem: "Neon leaves hum tomorrow..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/therapy-box", tracks: ["https://soundcloud.com/musique_residentielle/tb_01", "https://soundcloud.com/musique_residentielle/tb_02", "https://soundcloud.com/musique_residentielle/tb_03", "https://soundcloud.com/musique_residentielle/tb_04", "https://soundcloud.com/musique_residentielle/tb_05", "https://soundcloud.com/musique_residentielle/tb_06", "https://soundcloud.com/musique_residentielle/tb_07", "https://soundcloud.com/musique_residentielle/tb_08", "https://soundcloud.com/musique_residentielle/tb_09", "https://soundcloud.com/musique_residentielle/tb_10", "https://soundcloud.com/musique_residentielle/tb_11", "https://soundcloud.com/musique_residentielle/tb_12"], title: "Therapy Box", art: "https://i1.sndcdn.com/artworks-000683627282-9r4s1u-t500x500.jpg", poem: "Silence grows in tiny hearts..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/romantic-box", tracks: ["https://soundcloud.com/musique_residentielle/rb_01", "https://soundcloud.com/musique_residentielle/rb_02", "https://soundcloud.com/musique_residentielle/rb_03", "https://soundcloud.com/musique_residentielle/rb_04", "https://soundcloud.com/musique_residentielle/rb_05", "https://soundcloud.com/musique_residentielle/rb_06", "https://soundcloud.com/musique_residentielle/rb_07", "https://soundcloud.com/musique_residentielle/rb_08", "https://soundcloud.com/musique_residentielle/rb_09", "https://soundcloud.com/musique_residentielle/rb_10", "https://soundcloud.com/musique_residentielle/rb_11", "https://soundcloud.com/musique_residentielle/rb_12"], title: "Romantic Box", art: "https://i1.sndcdn.com/artworks-000683727294-8q3r2t-t500x500.jpg", poem: "Ashen hands, I see the stain..."},
    {playlist: "https://soundcloud.com/musique_residentielle/sets/fiesta-box", tracks: ["https://soundcloud.com/musique_residentielle/fb_01", "https://soundcloud.com/musique_residentielle/fb_02", "https://soundcloud.com/musique_residentielle/fb_03", "https://soundcloud.com/musique_residentielle/fb_04", "https://soundcloud.com/musique_residentielle/fb_05", "https://soundcloud.com/musique_residentielle/fb_06", "https://soundcloud.com/musique_residentielle/fb_07", "https://soundcloud.com/musique_residentielle/fb_08", "https://soundcloud.com/musique_residentielle/fb_09", "https://soundcloud.com/musique_residentielle/fb_10", "https://soundcloud.com/musique_residentielle/fb_11", "https://soundcloud.com/musique_residentielle/fb_12"], title: "Fiesta Box", art: "https://i1.sndcdn.com/artworks-000683527270-0s5t2v-t500x500.jpg", poem: "Each spark remembers its tree..."}
  ];

  const radiusCircle = 34;
  albums.forEach((album,i)=>{
    const angle = (i/albums.length)*Math.PI*2;
    const x = Math.cos(angle)*radiusCircle;
    const z = Math.sin(angle)*radiusCircle;

    // TREE
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1.6,2.2,17,8), new THREE.MeshStandardMaterial({color:0x3d2817}));
    trunk.position.y = 8.5;
    const leaves = new THREE.Mesh(new THREE.SphereGeometry(7.5,10,8), new THREE.MeshStandardMaterial({color:0x0a2a0a}));
    leaves.position.y = 17;
    tree.add(trunk,leaves);

    // 12 FRUITS on canopy surface
    for(let f=0; f<12; f++){
      const shape = fruitShapes[Math.floor(Math.random()*fruitShapes.length)];
      const color = fruitColors[Math.floor(Math.random()*fruitColors.length)];
      const fruit = new THREE.Mesh(shape, new THREE.MeshStandardMaterial({color, emissive:color, emissiveIntensity:0.6}));
      const thetaF = Math.random()*Math.PI*2;
      const phiF = Math.acos(2*Math.random() - 1);
      const r = 7.5; // leaves radius
      fruit.position.set(r * Math.sin(phiF) * Math.cos(thetaF), 17 + (Math.cos(phiF) * r), r * Math.sin(phiF) * Math.sin(thetaF));
      fruit.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);
      fruit.scale.setScalar(0.4 + Math.random()*0.3);
      fruit.userData = {type:'fruit', url: album.tracks[f]};
      tree.add(fruit);
    }

    tree.position.set(x,0,z);
    scene.add(tree);

    // CHEST
    const chest = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(3.2,2,2.4), new THREE.MeshStandardMaterial({color:0x8B4513}));
    const lid = new THREE.Mesh(new THREE.BoxGeometry(3.3,0.5,2.5), new THREE.MeshStandardMaterial({color:0xA0522D}));
    lid.position.y = 1.25;
    chest.add(body,lid);

    const canvas = document.createElement('canvas'); canvas.width=canvas.height=256;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle='#8B0000'; ctx.fillRect(0,0,256,256);
    ctx.strokeStyle='#FFD700'; ctx.lineWidth=24;
    ctx.strokeRect(18,18,220,220); ctx.strokeRect(48,48,160,160);
    ctx.font='bold 146px Arial'; ctx.fillStyle='#FFD700'; ctx.textAlign='center'; ctx.fillText('П',128,182);
    const tex = new THREE.CanvasTexture(canvas);
    const panel = new THREE.Mesh(new THREE.PlaneGeometry(2.6,1.6), new THREE.MeshStandardMaterial({map:tex, emissive:0xff3366, emissiveIntensity:0.4}));
    panel.position.set(0,0.6,1.21);
    chest.add(panel);

    chest.position.set(x,0,z);
    chest.lookAt(0,0,0);
    chest.userData = {type:'chest', url: album.playlist, album};
    scene.add(chest);
  });

  // Background forest
  for(let i=0;i<250;i++){
    const a = Math.random()*Math.PI*2;
    const d = 80 + Math.random()*400;
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1,1.6,14,8), new THREE.MeshStandardMaterial({color:0x3d2817}));
    trunk.position.y = 7;
    const leaves = new THREE.Mesh(new THREE.SphereGeometry(6,8,6), new THREE.MeshStandardMaterial({color:0x0a2a0a}));
    leaves.position.y = 14;
    tree.add(trunk,leaves);
    tree.position.set(Math.cos(a)*d,0,Math.sin(a)*d);
    scene.add(tree);
  }

  // Interaction
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  const tooltip = document.getElementById('tooltip');
  let hovered = null;

  window.addEventListener('pointermove', e=>{
    mouse.x = (e.clientX/innerWidth)*2-1;
    mouse.y = -(e.clientY/innerHeight)*2+1;
    raycaster.setFromCamera(mouse,camera);
    const hits = raycaster.intersectObjects(scene.children,true);
    let found = null;
    for(let h of hits){
      if(h.object.userData && h.object.userData.type==='fruit'){
        found = h.object; break;
      }
      if(h.object.parent && h.object.parent.userData && h.object.parent.userData.type==='chest'){
        found = h.object.parent; break;
      }
    }
    if(found!==hovered){
      if(hovered) hovered.scale.set(1,1,1);
      hovered = found;
      if(hovered){
        hovered.scale.set(1.15,1.15,1.15);
        tooltip.textContent = 'Click to play ' + (hovered.userData.type === 'fruit' ? 'track' : 'playlist');
        tooltip.style.left = (e.clientX+15)+'px';
        tooltip.style.top = (e.clientY+15)+'px';
        tooltip.style.opacity = 1;
      } else tooltip.style.opacity = 0;
    }
  });

  window.addEventListener('click',()=>{ if(hovered){
    const type = hovered.userData.type;
    const url = hovered.userData.url;
    document.getElementById('album-title').textContent = type === 'fruit' ? 'Track' : 'Playlist';
    document.getElementById('album-art').src = '';
    document.getElementById('player-container').innerHTML = `<iframe width="100%" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=${url}&color=%235ab&auto_play=true"></iframe>`;
    document.getElementById('album-panel').style.display = 'block';
  }});

  document.querySelector('.close-btn').onclick = () => document.getElementById('album-panel').style.display='none';

  // Animation
  const clock = new THREE.Clock();
  function animate(){
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();
    const pulse = 1 + Math.sin(t*1.2)*0.04;
    stonehenge.scale.setScalar(pulse);
    aura.material.opacity = 0.2 + Math.sin(t*1.5)*0.1;
    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener('resize',()=>{ camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });
</script>
</body>
</html>
