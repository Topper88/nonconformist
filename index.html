<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>п o п c o п f o r m i s t | The Circle of Seven v0.5.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; overflow:hidden; background:#000; font-family:'Courier New',monospace; }
  #info { position:absolute; top:20px; left:20px; color:#ddd; background:rgba(0,0,0,0.6); padding:15px; border-radius:12px; max-width:340px; backdrop-filter:blur(10px); z-index:10; border:1px solid #334; }
  #info a { color:#8cf; }
  .tooltip { position:absolute; background:rgba(20,20,40,0.95); color:#fff; padding:10px 16px; border-radius:10px; font-size:14px; pointer-events:none; opacity:0; transition:opacity .3s; z-index:100; backdrop-filter:blur(12px); border:1px solid #556; }
  .album-panel { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(15,15,35,0.98); color:#fff; padding:30px; border-radius:20px; width:380px; box-shadow:0 0 60px rgba(100,180,255,0.5); display:none; z-index:200; backdrop-filter:blur(16px); border:1px solid #667; }
  .close-btn { position:absolute; top:12px; right:16px; font-size:28px; cursor:pointer; color:#aaa; }
  .close-btn:hover { color:#fff; }
  #cc { position:absolute; bottom:20px; right:20px; color:#666; font-size:11px; z-index:10; }
  #cc a { color:#8cf; text-decoration:none; }
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
</head>
<body>

<div id="info">
  <strong>п o п c o п f o r m i s t</strong><br>
  <em>The Circle of Seven v0.5.2 — FINAL CLEAN</em><br><br>
  Orbit • Click a chest • Feel the circle<br>
  <a href="https://ko-fi.com/nnconformist" target="_blank">Tip if it moves you</a>
</div>
<div class="tooltip" id="tooltip"></div>
<div id="cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></div>

<div id="album-panel" class="album-panel">
  <div class="close-btn">×</div>
  <h3 id="album-title"></h3>
  <img id="album-art" width="100%" style="border-radius:12px; margin:16px 0;">
  <div id="player-container"></div>
</div>

<script>
  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x0a1a2f, 0.0008);
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  // Sky + stars
  scene.background = new THREE.Color(0x0a0a1f);
  const starsGeo = new THREE.BufferGeometry();
  const starsPos = [];
  for(let i=0;i<3000;i++) {
    starsPos.push(THREE.MathUtils.randFloatSpread(1000));
    starsPos.push(THREE.MathUtils.randFloatSpread(1000));
    starsPos.push(THREE.MathUtils.randFloatSpread(1000));
  }
  starsGeo.setAttribute('position', new THREE.Float32BufferAttribute(starsPos,3));
  const stars = new THREE.Points(starsGeo, new THREE.PointsMaterial({color:0xffffff,size:1.2}));
  scene.add(stars);

  // Lights
  scene.add(new THREE.AmbientLight(0x404060, 0.8));
  const moon = new THREE.DirectionalLight(0xaaccff, 1.4);
  moon.position.set(30,50,20);
  scene.add(moon);

  // Ground
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(800,800),
    new THREE.MeshStandardMaterial({color:0x0a1a0a, roughness:1})
  );
  ground.rotation.x = -Math.PI/2;
  ground.position.y = -1;
  scene.add(ground);

  // === CENTRAL STONEHENGE ===
  const stonehenge = new THREE.Group();
  const stoneMat = new THREE.MeshStandardMaterial({color:0x777777, roughness:0.95});

  const leftPillar = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), stoneMat);
  leftPillar.position.set(-6,6,0);
  leftPillar.castShadow = true;

  const rightPillar = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), stoneMat);
  rightPillar.position.set(6,6,0);
  rightPillar.castShadow = true;

  const lintel = new THREE.Mesh(new THREE.BoxGeometry(15,3,3.5), stoneMat);
  lintel.position.set(0,13,0);
  lintel.castShadow = true;

  stonehenge.add(leftPillar, rightPillar, lintel);

  const aura = new THREE.Mesh(
    new THREE.SphereGeometry(12,32,16),
    new THREE.MeshBasicMaterial({color:0x88ccff, transparent:true, opacity:0.2})
  );
  aura.position.y = 7;
  stonehenge.add(aura);
  scene.add(stonehenge);

  // === ALBUMS & CIRCLE OF SEVEN ===
  const albums = [
    {title:"Optima Box: The Future Is Inviting",url:"https://on.soundcloud.com/nWSYB7e87sdZaWxtT9",art:"https://i1.sndcdn.com/artworks-000684027330-5v4q3t-t500x500.jpg",poem:"Neon leaves hum tomorrow..."},
    {title:"Wisdom Box: As We Learn Cycling",url:"https://on.soundcloud.com/Mw8UtbDGZ7QhLD61jj",art:"https://i1.sndcdn.com/artworks-000683927318-7p1r5t-t500x500.jpg",poem:"Wheels wobble, lessons sting..."},
    {title:"Mystery Box: It Has Always Been Here",url:"https://on.soundcloud.com/NIuOde9LeVrnLcTWCa",art:"https://i1.sndcdn.com/artworks-000683827306-0p2q3s-t500x500.jpg",poem:"Truth hides in the rain..."},
    {title:"Romantic Box: Premature Farewell",url:"https://on.soundcloud.com/BkPQQv8bqULarvOMtw",art:"https://i1.sndcdn.com/artworks-000683727294-8q3r2t-t500x500.jpg",poem:"Ashen hands, I see the stain..."},
    {title:"Therapy Box: Hello Mailer-Daemon",url:"https://on.soundcloud.com/kmQCqO4ulClTDsQg1O",art:"https://i1.sndcdn.com/artworks-000683627282-9r4s1u-t500x500.jpg",poem:"Silence grows in tiny hearts..."},
    {title:"Fiesta Box: Fruity Outcome",url:"https://on.soundcloud.com/1vbOMYoRnitq1s6r4o",art:"https://i1.sndcdn.com/artworks-000683527270-0s5t2v-t500x500.jpg",poem:"Each spark remembers its tree..."},
    {title:"Energy Box: Time Is Here",url:"https://on.soundcloud.com/QNehEABnSeSodbnKWF",art:"https://i1.sndcdn.com/artworks-000683427258-1t6u3w-t500x500.jpg",poem:"Pulse now, the moment ignites..."}
  ];

  const radius = 32;
  albums.forEach((album,i)=>{
    const angle = (i/albums.length)*Math.PI*2;
    const x = Math.cos(angle)*radius;
    const z = Math.sin(angle)*radius;

    // Tree
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1.4,2,16,8), new THREE.MeshStandardMaterial({color:0x3d2817}));
    trunk.position.y = 8;
    const leaves = new THREE.Mesh(new THREE.SphereGeometry(7,8,6), new THREE.MeshStandardMaterial({color:0x0a2a0a}));
    leaves.position.y = 16;
    tree.add(trunk,leaves);
    tree.position.set(x,0,z);
    scene.add(tree);

    // Chest at trunk base
    const chest = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(3.2,2,2.4), new THREE.MeshStandardMaterial({color:0x8B4513}));
    const lid = new THREE.Mesh(new THREE.BoxGeometry(3.3,0.5,2.5), new THREE.MeshStandardMaterial({color:0xA0522D}));
    lid.position.y = 1.25;
    chest.add(body,lid);

    // П logo
    const canvas = document.createElement('canvas'); canvas.width=canvas.height=256;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle='#8B0000'; ctx.fillRect(0,0,256,256);
    ctx.strokeStyle='#FFD700'; ctx.lineWidth=24;
    ctx.strokeRect(18,18,220,220); ctx.strokeRect(48,48,160,160);
    ctx.font='bold 146px Arial'; ctx.fillStyle='#FFD700'; ctx.textAlign='center'; ctx.fillText('П',128,182);
    const tex = new THREE.CanvasTexture(canvas);
    const panel = new THREE.Mesh(new THREE.PlaneGeometry(2.6,1.6), new THREE.MeshStandardMaterial({map:tex, emissive:0xff3366, emissiveIntensity:0.4}));
    panel.position.set(0,0.6,1.21);
    chest.add(panel);

    chest.position.set(x,0,z);
    chest.lookAt(0,0,0);
    chest.userData = {type:'chest', album};
    scene.add(chest);
  });

  // Background forest
  for(let i=0;i<200;i++){
    const a = Math.random()*Math.PI*2;
    const d = 70 + Math.random()*400;
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1,1.6,14,8), new THREE.MeshStandardMaterial({color:0x3d2817}));
    trunk.position.y = 7;
    const leaves = new THREE.Mesh(new THREE.SphereGeometry(6,8,6), new THREE.MeshStandardMaterial({color:0x0a2a0a}));
    leaves.position.y = 14;
    tree.add(trunk,leaves);
    tree.position.set(Math.cos(a)*d,0,Math.sin(a)*d);
    scene.add(tree);
  }

  // Interaction
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  const tooltip = document.getElementById('tooltip');
  let hovered = null;

  window.addEventListener('pointermove', e=>{
    mouse.x = (e.clientX/innerWidth)*2-1;
    mouse.y = -(e.clientY/innerHeight)*2+1;
    raycaster.setFromCamera(mouse,camera);
    const hits = raycaster.intersectObjects(scene.children,true);
    let found = null;
    for(let h of hits){
      if(h.object.parent && h.object.parent.userData && h.object.parent.userData.type==='chest'){
        found = h.object.parent; break;
      }
    }
    if(found!==hovered){
      if(hovered) hovered.scale.set(1,1,1);
      hovered = found;
      if(hovered){
        hovered.scale.set(1.15,1.15,1.15);
        tooltip.textContent = hovered.userData.album.title.split(':')[0] + ' – ' + hovered.userData.album.poem;
        tooltip.style.left = (e.clientX+15)+'px';
        tooltip.style.top = (e.clientY+15)+'px';
        tooltip.style.opacity = 1;
      } else tooltip.style.opacity = 0;
    }
  });

  window.addEventListener('click',()=>{ if(hovered){
    const a = hovered.userData.album;
    document.getElementById('album-title').textContent = a.title;
    document.getElementById('album-art').src = a.art;
    document.getElementById('player-container').innerHTML = `<iframe width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=${a.url}&color=%235ab&auto_play=true"></iframe>`;
    document.getElementById('album-panel').style.display = 'block';
  }});

  document.querySelector('.close-btn').onclick = () => document.getElementById('album-panel').style.display='none';

  // Animation
  camera.position.set(0,18,60);
  let theta = 0;
  const clock = new THREE.Clock();
  function animate(){
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();

    theta += 0.0002;
    camera.position.x = Math.sin(theta)*60;
    camera.position.z = Math.cos(theta)*60;
    camera.lookAt(0,6,0);

    const pulse = 1 + Math.sin(t*1.2)*0.04;
    stonehenge.scale.setScalar(pulse);
    aura.material.opacity = 0.2 + Math.sin(t*1.5)*0.1;

    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener('resize',()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
  });

  console.log('The Circle of Seven v0.5.2 — CLEAN & PERFECT');
</script>
</body>
</html>
