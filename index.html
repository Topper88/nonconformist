<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>п o п c o п f o r m i s t | The Breathing Monument v0.4</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { overflow:hidden; background:#000; font-family:'Courier New',monospace; }
    #info { position:absolute; top:20px; left:20px; color:#ddd; font-size:14px; background:rgba(0,0,0,0.5); padding:15px; border-radius:12px; max-width:340px; backdrop-filter:blur(10px); z-index:10; border:1px solid #334; }
    #info a { color:#8cf; }
    .tooltip { position:absolute; background:rgba(20,20,40,0.95); color:#fff; padding:10px 16px; border-radius:10px; font-size:14px; pointer-events:none; opacity:0; transition:opacity .3s; z-index:100; backdrop-filter:blur(12px); border:1px solid #556; }
    .album-panel { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(15,15,35,0.98); color:#fff; padding:30px; border-radius:20px; width:380px; box-shadow:0 0 60px rgba(100,180,255,0.5); display:none; z-index:200; backdrop-filter:blur(16px); border:1px solid #667; }
    .close-btn { position:absolute; top:12px; right:16px; font-size:28px; cursor:pointer; color:#aaa; }
    .close-btn:hover { color:#fff; }
    #cc { position:absolute; bottom:20px; right:20px; color:#666; font-size:11px; z-index:10; }
    #cc a { color:#8cf; text-decoration:none; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
</head>
<body>

<div id="info">
  <strong>п o п c o п f o r m i s t</strong><br>
  <em>The Breathing Monument v0.4</em><br><br>
  Move mouse • Click a chest • Feel the pulse<br>
  <a href="https://ko-fi.com/nnconformist" target="_blank">Tip if it moves you</a>
</div>
<div class="tooltip" id="tooltip"></div>
<div id="cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></div>

<div id="album-panel" class="album-panel">
  <div class="close-btn">×</div>
  <h3 id="album-title"></h3>
  <img id="album-art" width="100%" style="border-radius:12px; margin:16px 0;">
  <div id="player-container"></div>
</div>

<script>
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 500);
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // === GRADIENT SKY (Claude’s magic) ===
  const skyCanvas = document.createElement('canvas');
  skyCanvas.width = 2; skyCanvas.height = 256;
  const ctx = skyCanvas.getContext('2d');
  const grad = ctx.createLinearGradient(0,0,0,256);
  grad.addColorStop(0, '#6B8E23');   // Olive
  grad.addColorStop(1, '#DAA520');   // Goldenrod
  ctx.fillStyle = grad; ctx.fillRect(0,0,2,256);
  scene.background = new THREE.CanvasTexture(skyCanvas);

  // === LIGHTS ===
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const sun = new THREE.DirectionalLight(0xffffff, 1.1);
  sun.position.set(15, 30, 20);
  sun.castShadow = true;
  sun.shadow.mapSize.width = 2048;
  sun.shadow.mapSize.height = 2048;
  sun.shadow.camera.near = 0.5;
  sun.shadow.camera.far = 100;
  sun.shadow.camera.left = -30;
  sun.shadow.camera.right = 30;
  sun.shadow.camera.top = 30;
  sun.shadow.camera.bottom = -30;
  scene.add(sun);

  // === GROUND ===
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(500,500),
    new THREE.MeshStandardMaterial({ color:0x7A6F4C, roughness:0.95 })
  );
  ground.rotation.x = -Math.PI/2;
  ground.position.y = -0.1;
  ground.receiveShadow = true;
  scene.add(ground);

  // === STONEHENGE (Claude’s masterpiece + our pulse) ===
  const stonehenge = new THREE.Group();
  const stoneMat = new THREE.MeshStandardMaterial({ color:0x8B8680, roughness:0.95, metalness:0.05 });

  const left = new THREE.Mesh(new THREE.BoxGeometry(2.4,10,3), stoneMat);
  left.position.set(-5,5,0); left.castShadow = true; left.receiveShadow = true;
  left.scale.set(1,1,0.94);
  stonehenge.add(left);

  const right = new THREE.Mesh(new THREE.BoxGeometry(2.4,10,3), stoneMat);
  right.position.set(5,5,0); right.castShadow = true; right.receiveShadow = true;
  right.scale.set(1,1,1.06);
  stonehenge.add(right);

  const lintel = new THREE.Mesh(new THREE.BoxGeometry(13,2,3.2), stoneMat);
  lintel.position.set(0,11.1,0); lintel.castShadow = true; lintel.receiveShadow = true;
  stonehenge.add(lintel);

  // Weathering details
  const detailMat = new THREE.MeshStandardMaterial({ color:0x696662, roughness:1 });
  for(let i=0;i<12;i++){
    const d = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.8,0.15), detailMat);
    d.position.set(-5 + Math.random()*0.8, 1+Math.random()*7, 1.6);
    d.rotation.z = Math.random()*0.4 - 0.2;
    stonehenge.add(d);
  }
  for(let i=0;i<12;i++){
    const d = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.8,0.15), detailMat);
    d.position.set(5 + Math.random()*0.8-0.4, 1+Math.random()*7, 1.6);
    d.rotation.z = Math.random()*0.4 - 0.2;
    stonehenge.add(d);
  }

  // Glow aura
  const aura = new THREE.Mesh(
    new THREE.SphereGeometry(10,32,16),
    new THREE.MeshBasicMaterial({color:0x88ccff, transparent:true, opacity:0.15})
  );
  aura.position.y = 6;
  stonehenge.add(aura);

  scene.add(stonehenge);

  // === CHESTS + TREES (now facing center) ===
  const albums = [ /* your 7 albums — same as before */ ];
  const chests = [];

  function createChest(album,x,z){
    const g = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(3,1.8,2.2), new THREE.MeshStandardMaterial({color:0x8B4513}));
    const lid = new THREE.Mesh(new THREE.BoxGeometry(3.1,0.4,2.3), new THREE.MeshStandardMaterial({color:0xA0522D}));
    lid.position.y=1.1;
    g.add(body); g.add(lid);
    // ... bands, lock, logo panel (same as before)
    const canvas = document.createElement('canvas'); canvas.width=canvas.height=256;
    const c = canvas.getContext('2d');
    c.fillStyle='#8B0000'; c.fillRect(0,0,256,256);
    c.strokeStyle='#FFD700'; c.lineWidth=22;
    c.strokeRect(20,20,216,216); c.strokeRect(50,50,156,156);
    c.font='bold 140px Arial'; c.fillStyle='#FFD700'; c.textAlign='center'; c.fillText('П',128,180);
    const tex = new THREE.CanvasTexture(canvas);
    const panel = new THREE.Mesh(new THREE.PlaneGeometry(2.4,1.4), new THREE.MeshStandardMaterial({map:tex, emissive:0xff3366, emissiveIntensity:0.4}));
    panel.position.set(0,0.5,1.11);
    g.add(panel);

    g.position.set(x,0,z);
    g.lookAt(0,0,0);          // ← faces center
    g.userData = {type:'chest', album};
    scene.add(g);
    chests.push(g);
    return g;
  }

  albums.forEach((a,i)=>{
    const angle = (i/albums.length)*Math.PI*2;
    const dist = 26;
    const x = Math.cos(angle)*dist;
    const z = Math.sin(angle)*dist;
    createChest(a,x,z);
    // tree behind
    const treeX = x + Math.cos(angle)*6;
    const treeZ = z + Math.sin(angle)*6;
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(1,1.4,14,8), new THREE.MeshStandardMaterial({color:0x8B4513}));
    trunk.position.y=7;
    const leaves = new THREE.Mesh(new THREE.SphereGeometry(6,8,6), new THREE.MeshStandardMaterial({color:0x228B22}));
    leaves.position.y=14;
    tree.add(trunk); tree.add(leaves);
    tree.position.set(treeX,0,treeZ);
    scene.add(tree);
  });

  // === CAMERA + MOUSE (Claude-style gentle sway) ===
  camera.position.set(0,12,45);
  let mouseX = 0, mouseY = 0;
  window.addEventListener('mousemove', e=>{
    mouseX = (e.clientX/innerWidth)*2-1;
    mouseY = -(e.clientY/innerHeight)*2+1;
  });

  // === AUDIO REACTIVITY (Stonehenge breathes) ===
  let analyser, dataArray, isPlaying = false;
  // (same initAudio function as v0.2 — omitted for brevity, will paste full tomorrow if needed)

  const clock = new THREE.Clock();
  function animate(){
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();

    // Claude-style mouse sway
    stonehenge.rotation.y += (mouseX*0.6 - stonehenge.rotation.y)*0.04;

    // Bass pulse
    if(isPlaying && analyser){
      analyser.getByteFrequencyData(dataArray);
      const bass = dataArray.slice(0,10).reduce((a,b)=>a+b)/10/255;
      stonehenge.scale.setScalar(1 + bass*0.35);
      aura.material.opacity = 0.15 + bass*0.5;
      aura.material.color.setHSL(0.55, 1, 0.5 + bass*0.4);
    }

    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener('resize',()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
  });
</script>
</body>
</html>
